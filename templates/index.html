<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashback Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            padding: 20px;
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo-container img {
            max-width: 100%;
            height: auto;
            width: clamp(150px, 40vw, 300px);
            display: block;
            margin: 0 auto;
        }
        .search-container {
            max-width: 800px;
            width: 90%;
            margin: 0 auto;
            position: relative;
        }
        #merchantInput {
            width: 100%;
            padding: 12px 20px;
            font-size: clamp(16px, 4vw, 18px);
            border: 2px solid #dfe6e9;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #merchantInput:focus {
            border-color: #3498db;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.2);
        }
        #suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dfe6e9;
            border-radius: 10px;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        #suggestions div {
            padding: 10px 15px;
            cursor: pointer;
            font-size: clamp(14px, 3.5vw, 16px);
            transition: background 0.2s;
        }
        #suggestions div:hover {
            background: #ecf0f1;
        }
        #resultsTable {
            max-width: 800px;
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            font-size: clamp(14px, 3.5vw, 16px);
        }
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: clamp(12px, 3vw, 14px);
        }
        td {
            border-bottom: 1px solid #dfe6e9;
            word-break: break-word;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:nth-child(even) {
            background: #f9fafb;
        }
        a {
            color: #e74c3c;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 12px;
            transition: background 0.3s, color 0.3s;
            display: inline-block;
            font-size: clamp(12px, 3vw, 14px);
        }
        a:hover {
            background: #e74c3c;
            color: white;
        }

        /* Featured Suppliers / Dynamic Merchant Index */
        .supplier-section {
            max-width: 800px;
            width: 90%;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .supplier-section h2 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        .supplier-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .supplier-grid div {
            padding: 8px;
            font-size: clamp(14px, 3.5vw, 16px);
            cursor: pointer;
            transition: background 0.2s;
        }
        .supplier-grid div:hover {
            background: #ecf0f1;
        }
        .pagination {
            text-align: center;
            margin-top: 20px;
        }
        .pagination a {
            display: inline-block;
            margin: 0 5px;
            padding: 8px 12px;
            background: #dfe6e9;
            color: #333;
            border-radius: 50%;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s, color 0.3s;
        }
        .pagination a:hover, .pagination a.active {
            background: #3498db;
            color: white;
        }

        /* Content Sections */
        .content-section {
            max-width: 800px;
            width: 90%;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .content-section h2 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        .content-section p, .content-section li {
            font-size: clamp(14px, 3.5vw, 16px);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .content-section ul, .content-section ol {
            padding-left: 20px;
        }
        .content-section details {
            margin-bottom: 15px;
        }
        .content-section summary {
            cursor: pointer;
            font-weight: 600;
            font-size: clamp(14px, 3.5vw, 16px);
            color: #3498db;
        }

        /* Tablet Adjustments */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            .search-container, #resultsTable, .supplier-section, .content-section {
                width: 95%;
            }
            #merchantInput {
                padding: 10px 15px;
            }
            #suggestions div {
                padding: 8px 12px;
            }
            th, td {
                padding: 10px 12px;
            }
            .supplier-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Mobile Adjustments */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .logo-container img {
                width: 100%;
            }
            .search-container, #resultsTable, .supplier-section, .content-section {
                width: 100%;
            }
            #resultsTable {
                display: block;
                overflow-x: auto;
                white-space: normal;
            }
            th, td {
                padding: 8px 10px;
                min-width: 100px;
            }
            .supplier-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 columns on mobile */
            }
            .pagination a {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Cashback Search Logo">
    </div>
    <div class="search-container">
        <input type="text" id="merchantInput" placeholder="Search for a merchant...">
        <div id="suggestions"></div>
    </div>
    <table id="resultsTable" style="display: none;">
        <thead>
            <tr>
                <th>Site</th>
                <th>Cashback</th>
                <th>URL</th>
            </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
    </table>

    <!-- Featured Suppliers / Dynamic Merchant Index -->
    <section class="supplier-section" id="supplierSection">
        <h2 id="supplierTitle">Featured Suppliers</h2>
        <div class="supplier-grid" id="supplierGrid"></div>
        <div class="pagination" id="pagination"></div>
    </section>

    <!-- About This Tool -->
    <section class="content-section">
        <h2>About This Tool</h2>
        <p>Cashback Search is a free, easy-to-use tool designed to help you find the best cashback offers from three leading Australian cashback platforms: ShopBack, TopCashback, and Cashrewards. Whether you're shopping for clothes, travel, or tech, simply enter a merchant name to see available cashback rates and links to check them out—all in one place!</p>
    </section>

    <!-- How to Use -->
    <section class="content-section">
        <h2>How to Use</h2>
        <ol>
            <li>Type the name of a merchant (e.g., "Adore Beauty" or "Amazon") into the search bar above.</li>
            <li>Select the merchant from the dropdown suggestions or click one from the list below.</li>
            <li>View the cashback offers in the table—each row shows the site, cashback rate, and a link to visit.</li>
            <li>Click "Go" to proceed with a cashback offer, or "Check" if no cashback is listed to verify manually.</li>
        </ol>
    </section>

    <!-- Disclaimer -->
    <section class="content-section">
        <h2>Disclaimer</h2>
        <p>This tool provides cashback information based on web scraping and is for informational purposes only. While we strive for accuracy, offers may change, and errors can occur. <strong>Always verify the cashback offer directly on the cashback site before making a purchase</strong>, especially if the merchant name seems incorrect or no cashback is shown. We are not responsible for inaccuracies, outdated information, or any financial loss resulting from reliance on this tool.</p>
    </section>

    <!-- FAQ -->
    <section class="content-section">
        <h2>Frequently Asked Questions (FAQ)</h2>
        <details>
            <summary>What is cashback?</summary>
            <p>Cashback is a reward offered by certain websites where you get a percentage of your purchase amount back after shopping through their links.</p>
        </details>
        <details>
            <summary>Why does it say "No Cashback Available"?</summary>
            <p>This means our tool couldn’t find a cashback offer for that merchant on the site at the time of the search. Click "Check" to visit the site and confirm manually.</p>
        </details>
        <details>
            <summary>Are all merchants covered?</summary>
            <p>We search a curated list of merchants from our database. If a merchant isn’t listed, try a similar name or check the cashback sites directly.</p>
        </details>
        <details>
            <summary>Is this tool affiliated with the cashback sites?</summary>
            <p>No, we’re an independent tool designed to help users compare offers. We don’t earn commissions or have partnerships with these sites.</p>
        </details>
    </section>

    <!-- About Cashback Sites -->
    <section class="content-section">
        <h2>About the Cashback Sites</h2>
        <h3>ShopBack</h3>
        <p>Founded in 2014 in Singapore, ShopBack has grown into one of Asia-Pacific’s leading cashback platforms, expanding to Australia and beyond. It partners with thousands of retailers, offering cashback on everything from fashion to travel, with a mission to make shopping more rewarding.</p>
        <h3>TopCashback</h3>
        <p>Launched in 2005 in the UK, TopCashback is one of the world’s largest cashback sites, entering the Australian market later. Known for passing 100% of commissions to users, it’s a favorite for maximizing savings across a wide range of stores.</p>
        <h3>Cashrewards</h3>
        <p>Started in 2014 in Australia, Cashrewards is a homegrown cashback platform that’s become a go-to for Aussie shoppers. With partnerships across major retailers, it’s known for competitive rates and a user-friendly experience.</p>
    </section>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const merchantsResponse = await fetch('/merchants');
            const merchants = await merchantsResponse.json();
            const itemsPerPage = 60; // 20 rows * 3 columns
            let currentLetter = null;

            // Featured Suppliers
            const featuredSuppliers = [
                "THE ICONIC", "Temu", "AliExpress", "Boost Mobile", "EnergyAustralia", "Bupa", "Lancome", "Napoleon Perdis",
                "NET-A-PORTER", "Woolworths Online", "Dyson", "Huddle Insurance", "NIB", "Compare the Market", "Wotif",
                "Flight Centre", "Fitness First", "Target", "adidas", "Hampers With Bite", "H&M", "Adairs", "OZSALE",
                "Glue Store", "General Pants Co", "Petstock", "Best&Less", "LEGO", "Mytheresa", "New Balance",
                "Paula's Choice", "Planet Fitness", "Forever New", "The Good Guys Gift Card", "JD Sports", "Mejuri",
                "Vision Direct", "gorman", "CALVIN KLEIN", "Giorgio Armani Beauty", "Princess Polly", "Camilla",
                "Taking Shape", "Florsheim", "YSL Beauty", "Reebok", "Lincraft", "Samsonite", "American Tourister",
                "Lovehoney", "Princess Highway", "Petal and Pup", "Charles Tyrwhitt", "Glassons", "Coach",
                "Freely Travel Insurance", "High Sierra", "Binge"
            ].filter(m => merchants.includes(m));

            function displaySuppliers(letter = null) {
                const grid = document.getElementById('supplierGrid');
                const title = document.getElementById('supplierTitle');
                grid.innerHTML = '';

                if (!letter) {
                    title.textContent = "Featured Suppliers";
                    featuredSuppliers.forEach(supplier => {
                        const div = document.createElement('div');
                        div.textContent = supplier;
                        div.addEventListener('click', () => {
                            document.getElementById('merchantInput').value = supplier;
                            triggerSearch(supplier);
                            document.getElementById('merchantInput').scrollIntoView({ behavior: 'smooth' });
                        });
                        grid.appendChild(div);
                    });
                } else {
                    title.textContent = `Merchants Starting with ${letter}`;
                    const filteredMerchants = merchants.filter(m => m.toUpperCase().startsWith(letter)).slice(0, itemsPerPage);
                    filteredMerchants.forEach(merchant => {
                        const div = document.createElement('div');
                        div.textContent = merchant;
                        div.addEventListener('click', () => {
                            document.getElementById('merchantInput').value = merchant;
                            triggerSearch(merchant);
                            document.getElementById('merchantInput').scrollIntoView({ behavior: 'smooth' });
                        });
                        grid.appendChild(div);
                    });
                }

                const pagination = document.getElementById('pagination');
                pagination.innerHTML = '';
                'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').forEach(ltr => {
                    const a = document.createElement('a');
                    a.textContent = ltr;
                    a.href = '#';
                    if (ltr === letter) a.classList.add('active');
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentLetter = ltr;
                        displaySuppliers(ltr);
                        document.getElementById('merchantInput').scrollIntoView({ behavior: 'smooth' });
                    });
                    pagination.appendChild(a);
                });
                if (letter) {
                    const backLink = document.createElement('a');
                    backLink.textContent = 'Back to Featured';
                    backLink.href = '#';
                    backLink.style.marginLeft = '10px';
                    backLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentLetter = null;
                        displaySuppliers();
                    });
                    pagination.appendChild(backLink);
                }
            }

            // Trigger Search Function
            async function triggerSearch(merchant) {
                const resultsTable = document.getElementById('resultsTable');
                const resultsBody = document.getElementById('resultsBody');
                resultsBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';
                resultsTable.style.display = 'table';

                const formData = new FormData();
                formData.append('merchant', merchant);

                const response = await fetch('/search', {
                    method: 'POST',
                    body: formData
                });
                const results = await response.json();

                if (results.error) {
                    resultsBody.innerHTML = `<tr><td colspan="3">${results.error}</td></tr>`;
                    return;
                }

                resultsBody.innerHTML = '';
                results.forEach(result => {
                    const row = document.createElement('tr');
                    const buttonText = result.Cashback === "No Cashback Available" ? "Check" : "Go";
                    row.innerHTML = `
                        <td>${result.Site}</td>
                        <td>${result.Cashback}</td>
                        <td><a href="${result.URL}" target="_blank">${buttonText}</a></td>
                    `;
                    resultsBody.appendChild(row);
                });
            }

            // Initial Display
            displaySuppliers();

            // Existing Search Functionality
            const merchantInput = document.getElementById('merchantInput');
            const suggestionsDiv = document.getElementById('suggestions');

            merchantInput.addEventListener('input', async () => {
                const query = merchantInput.value.trim();
                if (query.length < 2) {
                    suggestionsDiv.innerHTML = '';
                    return;
                }
                const response = await fetch(`/suggest?q=${encodeURIComponent(query)}`);
                const suggestions = await response.json();
                suggestionsDiv.innerHTML = suggestions.map(s => `<div>${s}</div>`).join('');
            });

            suggestionsDiv.addEventListener('click', (e) => {
                const merchant = e.target.textContent;
                merchantInput.value = merchant;
                suggestionsDiv.innerHTML = '';
                triggerSearch(merchant);
            });
        });
    </script>
</body>
</html>
